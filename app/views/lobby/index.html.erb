<% content_for(:title) { "–õ–æ–±–±–∏" } %>

<div class="lobby-container">
  <header class="lobby-header">
    <h1>üéÆ Hamster Games</h1>
    <nav class="lobby-nav">
      <%= link_to "–ú–æ–∏ –∏–≥—Ä—ã", games_path, class: "nav-link" %>
      <%= link_to "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", statistics_path, class: "nav-link" %>
      <span class="player-info">üë§ <%= current_player.username %></span>
      <%= button_to "–í—ã–π—Ç–∏", logout_path, method: :delete, class: "btn btn-outline" %>
    </nav>
  </header>

  <main class="lobby-main">
    <section class="create-game">
      <h2>ü§ñ –ò–≥—Ä–∞—Ç—å —Å –±–æ—Ç–æ–º</h2>
      <div class="bot-games">
        <% @game_types.each do |game_type| %>
          <div class="bot-game-card">
            <div class="bot-game-header">
              <span class="game-icon">
                <%= case game_type
                    when 'tic_tac_toe' then '‚ùå‚≠ï'
                    when 'rpsls' then '‚úä‚úã‚úåÔ∏è'
                    when 'battleship' then 'üö¢üí•'
                    end %>
              </span>
              <span class="game-name">
                <%= case game_type
                    when 'tic_tac_toe' then '–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏'
                    when 'rpsls' then '–ö–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞-—è—â–µ—Ä–∏—Ü–∞-–°–ø–æ–∫'
                    when 'battleship' then '–ú–æ—Ä—Å–∫–æ–π –±–æ–π'
                    end %>
              </span>
            </div>
            <div class="difficulty-buttons">
              <% Game::BOT_DIFFICULTIES.each do |difficulty| %>
                <%= form_with model: Game.new, url: games_path, local: true, class: "bot-form" do |f| %>
                  <%= f.hidden_field :game_type, value: game_type %>
                  <%= f.hidden_field :bot_difficulty, value: difficulty %>
                  <button type="submit" class="difficulty-btn difficulty-<%= difficulty %>">
                    <%= case difficulty
                        when 'easy' then 'üòä –õ—ë–≥–∫–∏–π'
                        when 'medium' then 'ü§î –°—Ä–µ–¥–Ω–∏–π'
                        when 'hard' then 'üòà –°–ª–æ–∂–Ω—ã–π'
                        end %>
                  </button>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </section>

    <section class="create-game">
      <h2>üë• –ò–≥—Ä–∞—Ç—å —Å –∏–≥—Ä–æ–∫–æ–º</h2>
      <div class="game-type-cards">
        <% @game_types.each do |game_type| %>
          <%= form_with model: Game.new, url: games_path, local: true, class: "game-type-form" do |f| %>
            <%= f.hidden_field :game_type, value: game_type %>
            <button type="submit" class="game-type-card" data-game-type="<%= game_type %>">
              <span class="game-icon">
                <%= case game_type
                    when 'tic_tac_toe' then '‚ùå‚≠ï'
                    when 'rpsls' then '‚úä‚úã‚úåÔ∏è'
                    when 'battleship' then 'üö¢üí•'
                    end %>
              </span>
              <span class="game-name">
                <%= case game_type
                    when 'tic_tac_toe' then '–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏'
                    when 'rpsls' then '–ö–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞-—è—â–µ—Ä–∏—Ü–∞-–°–ø–æ–∫'
                    when 'battleship' then '–ú–æ—Ä—Å–∫–æ–π –±–æ–π'
                    end %>
              </span>
            </button>
          <% end %>
        <% end %>
      </div>
    </section>

    <section class="waiting-games" data-controller="lobby">
      <h2>–û–∂–∏–¥–∞—é—â–∏–µ –∏–≥—Ä—ã</h2>
      <div class="games-list" data-lobby-target="gamesList">
        <% if @games.empty? %>
          <p class="no-games">–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –∏–≥—Ä. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é!</p>
        <% else %>
          <% @games.each do |game| %>
            <div class="game-item" data-game-id="<%= game.id %>">
              <div class="game-info">
                <span class="game-type-badge"><%= game.game_type_name %></span>
                <span class="game-host">–•–æ—Å—Ç: <%= game.player1.username %></span>
              </div>
              <% unless game.player1 == current_player %>
                <%= link_to "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è", join_game_path(game), method: :post, class: "btn btn-primary" %>
              <% else %>
                <span class="waiting-badge">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </section>
  </main>
</div>
