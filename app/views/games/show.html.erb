<% content_for(:title) { @game.game_type_name } %>

<div class="game-container" data-controller="game" data-game-id="<%= @game.id %>" data-game-type="<%= @game.game_type %>" data-player-id="<%= current_player.id %>" data-current-turn-id="<%= @game.current_turn_id %>">
  <header class="game-header">
    <h1><%= @game.game_type_name %></h1>
    <%= link_to "‚Üê –õ–æ–±–±–∏", lobby_path, class: "back-link" %>
  </header>

  <div class="game-info-bar">
    <div class="player-info player1 <%= 'current-turn' if @game.current_turn_id == @game.player1_id %>">
      <span class="player-symbol">
        <% if @game.game_type == 'tic_tac_toe' %>‚ùå<% else %>üîµ<% end %>
      </span>
      <span class="player-name"><%= @game.player1.username %></span>
      <% if @game.player1 == current_player %>
        <span class="you-badge">(–í—ã)</span>
      <% end %>
    </div>
    <div class="vs">VS</div>
    <div class="player-info player2 <%= 'current-turn' if @game.current_turn_id == @game.player2_id %>">
      <% if @game.player2 %>
        <span class="player-symbol">
          <% if @game.game_type == 'tic_tac_toe' %>‚≠ï<% else %>üî¥<% end %>
        </span>
        <span class="player-name"><%= @game.player2.username %></span>
        <% if @game.player2 == current_player %>
          <span class="you-badge">(–í—ã)</span>
        <% end %>
      <% else %>
        <span class="waiting-opponent">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</span>
      <% end %>
    </div>
  </div>

  <div class="game-status" data-game-target="status">
    <% if @game.waiting? %>
      <p class="status-waiting">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</p>
    <% elsif @game.playing? %>
      <% if @game.current_turn == current_player %>
        <p class="status-your-turn">üéØ –í–∞—à —Ö–æ–¥!</p>
      <% else %>
        <p class="status-opponent-turn">‚è≥ –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</p>
      <% end %>
    <% elsif @game.finished? %>
      <% if @game.draw? %>
        <p class="status-draw">ü§ù –ù–∏—á—å—è!</p>
      <% elsif @game.winner == current_player %>
        <p class="status-win">üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!</p>
      <% else %>
        <p class="status-loss">üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏</p>
      <% end %>
    <% end %>
  </div>

  <div class="game-board" data-game-target="board">
    <% case @game.game_type %>
    <% when 'tic_tac_toe' %>
      <%= render 'games/tic_tac_toe', game: @game, current_player: current_player %>
    <% when 'rpsls' %>
      <%= render 'games/rpsls', game: @game, current_player: current_player %>
    <% when 'battleship' %>
      <%= render 'games/battleship', game: @game, current_player: current_player %>
    <% end %>
  </div>

  <div class="game-moves" data-game-target="moves">
    <h3>–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h3>
    <ul class="moves-list">
      <% @game.game_moves.each do |move| %>
        <li><%= move.description %></li>
      <% end %>
    </ul>
  </div>
</div>
