<% content_for(:title) { @game.game_type_name } %>

<div class="game-container" data-controller="game" data-game-id="<%= @game.id %>" data-game-type="<%= @game.game_type %>" data-player-id="<%= current_player.id %>" data-current-turn-id="<%= @game.current_turn_id %>">
  <header class="game-header">
    <h1><%= @game.game_type_name %></h1>
    <div class="header-actions">
      <button class="btn btn-outline btn-sm" data-action="click->game#showRules">üìñ –ü—Ä–∞–≤–∏–ª–∞</button>
      <%= link_to "‚Üê –õ–æ–±–±–∏", lobby_path, class: "back-link" %>
    </div>
  </header>

  <div class="game-info-bar" id="game-info-bar">
    <div class="player-info player1 <%= 'current-turn' if @game.current_turn_id == @game.player1_id %>">
      <span class="player-symbol">
        <% if @game.game_type == 'tic_tac_toe' %>‚ùå<% else %>üîµ<% end %>
      </span>
      <span class="player-name"><%= @game.player1.username %></span>
      <% if @game.player1 == current_player %>
        <span class="you-badge">(–í—ã)</span>
      <% end %>
    </div>
    <div class="vs">VS</div>
    <div class="player-info player2 <%= 'current-turn' unless @game.current_turn_id == @game.player1_id %>">
      <% if @game.vs_bot? %>
        <span class="player-symbol">ü§ñ</span>
        <span class="player-name">–ë–æ—Ç</span>
        <span class="bot-badge"><%= @game.bot_difficulty_name %></span>
      <% elsif @game.player2 %>
        <span class="player-symbol">
          <% if @game.game_type == 'tic_tac_toe' %>‚≠ï<% else %>üî¥<% end %>
        </span>
        <span class="player-name"><%= @game.player2.username %></span>
        <% if @game.player2 == current_player %>
          <span class="you-badge">(–í—ã)</span>
        <% end %>
      <% else %>
        <span class="waiting-opponent">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</span>
      <% end %>
    </div>
  </div>

  <div class="game-status" id="game-status" data-game-target="status">
    <% if @game.waiting? %>
      <p class="status-waiting">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</p>
    <% elsif @game.playing? %>
      <% if @game.current_turn == current_player %>
        <p class="status-your-turn">üéØ –í–∞—à —Ö–æ–¥!</p>
      <% else %>
        <p class="status-opponent-turn">‚è≥ –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</p>
      <% end %>
    <% elsif @game.finished? %>
      <% if @game.draw? %>
        <p class="status-draw">ü§ù –ù–∏—á—å—è!</p>
      <% elsif @game.bot_won? %>
        <p class="status-loss">üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏</p>
      <% elsif @game.winner == current_player %>
        <p class="status-win">üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!</p>
      <% else %>
        <p class="status-loss">üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏</p>
      <% end %>
      <div class="game-finished-actions">
        <%= form_with model: Game.new, url: games_path, method: :post, local: true, style: "display: inline-block;" do |f| %>
          <%= f.hidden_field :game_type, value: @game.game_type %>
          <% if @game.vs_bot? %>
            <%= f.hidden_field :bot_difficulty, value: @game.bot_difficulty %>
          <% end %>
          <%= f.submit "üîÑ –ò–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑", class: "btn btn-primary" %>
        <% end %>
        <%= link_to "‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–æ–±–±–∏", lobby_path, class: "btn btn-outline" %>
      </div>
    <% end %>
  </div>

  <div class="game-board" id="game-board" data-game-target="board">
    <% case @game.game_type %>
    <% when 'tic_tac_toe' %>
      <%= render 'games/tic_tac_toe', game: @game, current_player: current_player %>
    <% when 'rpsls' %>
      <%= render 'games/rpsls', game: @game, current_player: current_player %>
    <% when 'battleship' %>
      <%= render 'games/battleship', game: @game, current_player: current_player %>
    <% end %>
  </div>

  <div class="game-moves" data-game-target="moves">
    <h3>–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h3>
    <ul class="moves-list">
      <% @game.game_moves.each do |move| %>
        <li><%= move.description %></li>
      <% end %>
    </ul>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ -->
  <div class="modal" data-game-target="rulesModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
        <button class="modal-close" data-action="click->game#closeRules">&times;</button>
      </div>
      <div class="modal-body">
        <% case @game.game_type %>
        <% when 'tic_tac_toe' %>
          <h3>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</h3>
          <p><strong>–¶–µ–ª—å –∏–≥—Ä—ã:</strong> –ü–µ—Ä–≤—ã–º –≤—ã—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏ —Å–≤–æ–∏—Ö —Å–∏–º–≤–æ–ª–∞ (X –∏–ª–∏ O) –≤ —Ä—è–¥ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏, –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –∏–ª–∏ –¥–∏–∞–≥–æ–Ω–∞–ª–∏.</p>
          <p><strong>–ü—Ä–∞–≤–∏–ª–∞:</strong></p>
          <ul>
            <li>–ò–≥—Ä–æ–∫–∏ —Ö–æ–¥—è—Ç –ø–æ –æ—á–µ—Ä–µ–¥–∏, —Å—Ç–∞–≤—è —Å–≤–æ–π —Å–∏–º–≤–æ–ª –≤ —Å–≤–æ–±–æ–¥–Ω—É—é –∫–ª–µ—Ç–∫—É</li>
            <li>–ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ –∏–≥—Ä–∞–µ—Ç –∫—Ä–µ—Å—Ç–∏–∫–∞–º–∏ (X), –≤—Ç–æ—Ä–æ–π ‚Äî –Ω–æ–ª–∏–∫–∞–º–∏ (O)</li>
            <li>–ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –ø–µ—Ä–≤—ã–º –≤—ã—Å—Ç—Ä–æ–∏—Ç —Ç—Ä–∏ —Å–≤–æ–∏—Ö —Å–∏–º–≤–æ–ª–∞ –≤ —Ä—è–¥</li>
            <li>–ï—Å–ª–∏ –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏ –Ω–∏–∫—Ç–æ –Ω–µ –≤—ã–∏–≥—Ä–∞–ª ‚Äî –Ω–∏—á—å—è</li>
          </ul>
        <% when 'rpsls' %>
          <h3>–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞-–Ø—â–µ—Ä–∏—Ü–∞-–°–ø–æ–∫</h3>
          <p><strong>–¶–µ–ª—å –∏–≥—Ä—ã:</strong> –í—ã–±—Ä–∞—Ç—å —Å–∏–º–≤–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–±–µ–∂–¥–∞–µ—Ç —Å–∏–º–≤–æ–ª –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.</p>
          <p><strong>–ü—Ä–∞–≤–∏–ª–∞ –ø–æ–±–µ–¥:</strong></p>
          <ul>
            <li>‚úä <strong>–ö–∞–º–µ–Ω—å</strong> –∑–∞—Ç—É–ø–ª—è–µ—Ç –ù–æ–∂–Ω–∏—Ü—ã –∏ –¥–∞–≤–∏—Ç –Ø—â–µ—Ä–∏—Ü—É</li>
            <li>‚úã <strong>–ë—É–º–∞–≥–∞</strong> –∑–∞–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ö–∞–º–µ–Ω—å –∏ –æ–ø—Ä–æ–≤–µ—Ä–≥–∞–µ—Ç –°–ø–æ–∫–∞</li>
            <li>‚úåÔ∏è <strong>–ù–æ–∂–Ω–∏—Ü—ã</strong> —Ä–µ–∂—É—Ç –ë—É–º–∞–≥—É –∏ –æ–±–µ–∑–≥–ª–∞–≤–ª–∏–≤–∞—é—Ç –Ø—â–µ—Ä–∏—Ü—É</li>
            <li>ü¶é <strong>–Ø—â–µ—Ä–∏—Ü–∞</strong> –µ—Å—Ç –ë—É–º–∞–≥—É –∏ –æ—Ç—Ä–∞–≤–ª—è–µ—Ç –°–ø–æ–∫–∞</li>
            <li>üññ <strong>–°–ø–æ–∫</strong> –∏—Å–ø–∞—Ä—è–µ—Ç –ö–∞–º–µ–Ω—å –∏ –ª–æ–º–∞–µ—Ç –ù–æ–∂–Ω–∏—Ü—ã</li>
          </ul>
          <p>–ï—Å–ª–∏ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ –≤—ã–±—Ä–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Å–∏–º–≤–æ–ª ‚Äî –Ω–∏—á—å—è.</p>
        <% when 'battleship' %>
          <h3>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</h3>
          <p><strong>–¶–µ–ª—å –∏–≥—Ä—ã:</strong> –ü–µ—Ä–≤—ã–º –ø–æ—Ç–æ–ø–∏—Ç—å –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.</p>
          <p><strong>–†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ—Ä–∞–±–ª–µ–π:</strong></p>
          <ul>
            <li>1 —á–µ—Ç—ã—Ä—ë—Ö–ø–∞–ª—É–±–Ω—ã–π –∫–æ—Ä–∞–±–ª—å (–ª–∏–Ω–∫–æ—Ä)</li>
            <li>2 —Ç—Ä—ë—Ö–ø–∞–ª—É–±–Ω—ã—Ö –∫–æ—Ä–∞–±–ª—è (–∫—Ä–µ–π—Å–µ—Ä–∞)</li>
            <li>3 –¥–≤—É—Ö–ø–∞–ª—É–±–Ω—ã—Ö –∫–æ—Ä–∞–±–ª—è (—ç—Å–º–∏–Ω—Ü—ã)</li>
            <li>4 –æ–¥–Ω–æ–ø–∞–ª—É–±–Ω—ã—Ö –∫–æ—Ä–∞–±–ª—è (–ø–æ–¥–ª–æ–¥–∫–∏)</li>
          </ul>
          <p><strong>–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏:</strong></p>
          <ul>
            <li>–ö–æ—Ä–∞–±–ª–∏ –Ω–µ –º–æ–≥—É—Ç —Å–æ–ø—Ä–∏–∫–∞—Å–∞—Ç—å—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º (–¥–∞–∂–µ –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏)</li>
            <li>–ö–æ—Ä–∞–±–ª–∏ –º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—â–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –∏–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ</li>
            <li>–î–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è –≤—ã–±–µ—Ä–∏—Ç–µ –µ–≥–æ —Å–Ω–æ–≤–∞ –∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤ –Ω–æ–≤–æ–º –º–µ—Å—Ç–µ</li>
          </ul>
          <p><strong>–ü—Ä–∞–≤–∏–ª–∞ –±–æ—è:</strong></p>
          <ul>
            <li>–ò–≥—Ä–æ–∫–∏ —Å—Ç—Ä–µ–ª—è—é—Ç –ø–æ –æ—á–µ—Ä–µ–¥–∏, —É–∫–∞–∑—ã–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—ã—Å—Ç—Ä–µ–ª–∞</li>
            <li>–ü—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –∏–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç –µ—â—ë –æ–¥–∏–Ω –≤—ã—Å—Ç—Ä–µ–ª</li>
            <li>–ü—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ —Ö–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É</li>
            <li>–ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –ø–µ—Ä–≤—ã–º –ø–æ—Ç–æ–ø–∏—Ç –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</li>
          </ul>
        <% end %>
      </div>
    </div>
  </div>
</div>
