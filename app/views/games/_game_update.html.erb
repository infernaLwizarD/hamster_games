<%= turbo_stream.replace "game-status" do %>
  <div class="game-status" id="game-status" data-game-target="status">
    <% if game.waiting? %>
      <p class="status-waiting">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</p>
    <% elsif game.playing? %>
      <% if game.current_turn == current_player %>
        <p class="status-your-turn">üéØ –í–∞—à —Ö–æ–¥!</p>
      <% else %>
        <p class="status-opponent-turn">‚è≥ –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</p>
      <% end %>
    <% elsif game.finished? %>
      <% if game.draw? %>
        <p class="status-draw">ü§ù –ù–∏—á—å—è!</p>
      <% elsif game.bot_won? %>
        <p class="status-loss">üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏</p>
      <% elsif game.winner == current_player %>
        <p class="status-win">üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!</p>
      <% else %>
        <p class="status-loss">üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏</p>
      <% end %>
      <div class="game-finished-actions">
        <%= form_with model: Game.new, url: games_path, method: :post, local: true, style: "display: inline-block;" do |f| %>
          <%= f.hidden_field :game_type, value: game.game_type %>
          <% if game.vs_bot? %>
            <%= f.hidden_field :bot_difficulty, value: game.bot_difficulty %>
          <% end %>
          <%= f.submit "üîÑ –ò–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑", class: "btn btn-primary" %>
        <% end %>
        <%= link_to "‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–æ–±–±–∏", lobby_path, class: "btn btn-outline" %>
      </div>
    <% end %>
  </div>
<% end %>

<%= turbo_stream.replace "game-board" do %>
  <div class="game-board" id="game-board" data-game-target="board">
    <% case game.game_type %>
    <% when 'tic_tac_toe' %>
      <%= render 'games/tic_tac_toe', game: game, current_player: current_player %>
    <% when 'rpsls' %>
      <%= render 'games/rpsls', game: game, current_player: current_player %>
    <% when 'battleship' %>
      <%= render 'games/battleship', game: game, current_player: current_player %>
    <% end %>
  </div>
<% end %>

<%= turbo_stream.replace "game-info-bar" do %>
  <div class="game-info-bar" id="game-info-bar">
    <div class="player-info player1 <%= 'current-turn' if game.current_turn_id == game.player1_id %>">
      <span class="player-symbol">
        <% if game.game_type == 'tic_tac_toe' %>‚ùå<% else %>üîµ<% end %>
      </span>
      <span class="player-name"><%= game.player1.username %></span>
      <% if game.player1 == current_player %>
        <span class="you-badge">(–í—ã)</span>
      <% end %>
    </div>
    <div class="vs">VS</div>
    <div class="player-info player2 <%= 'current-turn' unless game.current_turn_id == game.player1_id %>">
      <% if game.vs_bot? %>
        <span class="player-symbol">ü§ñ</span>
        <span class="player-name">–ë–æ—Ç</span>
        <span class="bot-badge"><%= game.bot_difficulty_name %></span>
      <% elsif game.player2 %>
        <span class="player-symbol">
          <% if game.game_type == 'tic_tac_toe' %>‚≠ï<% else %>üî¥<% end %>
        </span>
        <span class="player-name"><%= game.player2.username %></span>
        <% if game.player2 == current_player %>
          <span class="you-badge">(–í—ã)</span>
        <% end %>
      <% else %>
        <span class="waiting-opponent">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</span>
      <% end %>
    </div>
  </div>
<% end %>
